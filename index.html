<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 20px;
            padding-bottom: 100px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        h1 {
            color: var(--tg-theme-text-color);
            margin-bottom: 10px;
            font-size: 24px;
        }
        
        .info {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .section {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
        }
        
        .section h2 {
            font-size: 16px;
            margin-bottom: 12px;
            color: var(--tg-theme-text-color);
        }
        
        button {
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            margin-bottom: 8px;
            transition: opacity 0.2s;
        }
        
        button:active {
            opacity: 0.8;
        }
        
        button.secondary {
            background: var(--tg-theme-secondary-bg-color, #e0e0e0);
            color: var(--tg-theme-text-color, #000000);
        }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--tg-theme-hint-color, #999999);
            border-radius: 8px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .output {
            background: var(--tg-theme-bg-color, #ffffff);
            border: 1px solid var(--tg-theme-hint-color, #999999);
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            background: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            border-radius: 6px;
            font-size: 11px;
            margin: 4px 4px 4px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Advanced Telegram Features</h1>
        
        <div class="info">
            <strong>Platform:</strong> <span id="platform"></span><br>
            <strong>Version:</strong> <span id="version"></span><br>
            <strong>User ID:</strong> <span id="userId"></span><br>
            <strong>Theme:</strong> <span id="colorScheme"></span>
        </div>

        <!-- Haptic Feedback -->
        <div class="section">
            <h2>üîî Haptic Feedback</h2>
            <button onclick="impactOccurred('light')">Light Impact</button>
            <button onclick="impactOccurred('medium')">Medium Impact</button>
            <button onclick="impactOccurred('heavy')">Heavy Impact</button>
            <button onclick="notificationOccurred('success')">Success Notification</button>
            <button onclick="notificationOccurred('error')">Error Notification</button>
            <button onclick="selectionChanged()">Selection Changed</button>
        </div>

        <!-- Cloud Storage -->
        <div class="section">
            <h2>‚òÅÔ∏è Cloud Storage</h2>
            <input type="text" id="storageKey" placeholder="Key (e.g., 'username')">
            <input type="text" id="storageValue" placeholder="Value (e.g., 'John')">
            <button onclick="saveToCloud()">Save to Cloud</button>
            <button onclick="loadFromCloud()" class="secondary">Load from Cloud</button>
            <button onclick="removeFromCloud()" class="secondary">Remove Key</button>
            <button onclick="getCloudKeys()" class="secondary">Get All Keys</button>
            <div id="cloudOutput" class="output"></div>
        </div>

        <!-- Popups & Alerts -->
        <div class="section">
            <h2>üí¨ Popups & Alerts</h2>
            <button onclick="showAlert()">Show Alert</button>
            <button onclick="showConfirm()">Show Confirm</button>
            <button onclick="showPopup()">Show Custom Popup</button>
            <button onclick="showScanQrPopup()">Scan QR Code</button>
        </div>

        <!-- Main Button & Back Button -->
        <div class="section">
            <h2>üéØ Main Button Control</h2>
            <button onclick="showMainButton()">Show Main Button</button>
            <button onclick="hideMainButton()">Hide Main Button</button>
            <button onclick="enableMainButton()">Enable Main Button</button>
            <button onclick="disableMainButton()">Disable Main Button</button>
            <button onclick="showProgress()">Show Progress</button>
            <button onclick="hideProgress()">Hide Progress</button>
        </div>

        <!-- Back Button -->
        <div class="section">
            <h2>‚¨ÖÔ∏è Back Button</h2>
            <button onclick="showBackButton()">Show Back Button</button>
            <button onclick="hideBackButton()">Hide Back Button</button>
        </div>

        <!-- Settings Button -->
        <div class="section">
            <h2>‚öôÔ∏è Settings Button</h2>
            <button onclick="showSettingsButton()">Show Settings Button</button>
            <button onclick="hideSettingsButton()">Hide Settings Button</button>
        </div>

        <!-- Biometric Authentication -->
        <div class="section">
            <h2>üîê Biometric Auth</h2>
            <div id="biometricInfo"></div>
            <button onclick="requestBiometric()">Authenticate</button>
            <button onclick="updateBiometricToken()" class="secondary">Update Token</button>
        </div>

        <!-- Links & External -->
        <div class="section">
            <h2>üîó Links & External</h2>
            <input type="text" id="linkUrl" placeholder="URL" value="https://telegram.org">
            <button onclick="openLink()">Open Link</button>
            <button onclick="openTelegramLink()">Open Telegram Link</button>
            <button onclick="openInvoice()">Open Test Invoice</button>
        </div>

        <!-- Data Sending -->
        <div class="section">
            <h2>üì§ Send Data to Bot</h2>
            <textarea id="dataToSend" placeholder="Enter data to send to bot" rows="3">{"action": "test", "value": 123}</textarea>
            <button onclick="sendDataToBot()">Send Data</button>
            <button onclick="closeApp()">Close Mini App</button>
        </div>

        <!-- Theme & Colors -->
        <div class="section">
            <h2>üé® Theme Control</h2>
            <button onclick="setHeaderColor('#FF5733')">Red Header</button>
            <button onclick="setHeaderColor('#3390ec')">Blue Header</button>
            <button onclick="setBackgroundColor('#1a1a1a')">Dark Background</button>
            <button onclick="setBackgroundColor('#ffffff')">Light Background</button>
        </div>

        <!-- Viewport Control -->
        <div class="section">
            <h2>üì± Viewport</h2>
            <button onclick="expandViewport()">Expand to Full Height</button>
            <button onclick="requestWriteAccess()">Request Write Access</button>
            <button onclick="requestContact()">Request Contact</button>
            <div id="viewportInfo" class="output"></div>
        </div>

        <!-- Available Features -->
        <div class="section">
            <h2>‚ú® Available Features</h2>
            <div id="features"></div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        
        // Initialize
        tg.ready();
        tg.expand();
        
        // Display basic info
        document.getElementById('platform').textContent = tg.platform;
        document.getElementById('version').textContent = tg.version;
        document.getElementById('userId').textContent = tg.initDataUnsafe?.user?.id || 'N/A';
        document.getElementById('colorScheme').textContent = tg.colorScheme;
        
        // Show available features
        const features = [
            'BiometricManager', 'CloudStorage', 'HapticFeedback',
            'MainButton', 'BackButton', 'SettingsButton',
            'SecondaryButton', 'ClosingConfirmation', 'PopupParams'
        ];
        
        const availableFeatures = features.filter(feature => {
            return tg[feature] || tg[feature.charAt(0).toLowerCase() + feature.slice(1)];
        });
        
        document.getElementById('features').innerHTML = availableFeatures
            .map(f => `<span class="badge">${f}</span>`)
            .join('');
        
        // Haptic Feedback
        function impactOccurred(style) {
            tg.HapticFeedback.impactOccurred(style);
        }
        
        function notificationOccurred(type) {
            tg.HapticFeedback.notificationOccurred(type);
        }
        
        function selectionChanged() {
            tg.HapticFeedback.selectionChanged();
        }
        
        // Cloud Storage
        function saveToCloud() {
            const key = document.getElementById('storageKey').value;
            const value = document.getElementById('storageValue').value;
            
            if (!key || !value) {
                tg.showAlert('Please enter both key and value');
                return;
            }
            
            tg.CloudStorage.setItem(key, value, (error, success) => {
                const output = document.getElementById('cloudOutput');
                if (error) {
                    output.textContent = `Error: ${error}`;
                } else {
                    output.textContent = `Saved: ${key} = ${value}`;
                    tg.HapticFeedback.notificationOccurred('success');
                }
            });
        }
        
        function loadFromCloud() {
            const key = document.getElementById('storageKey').value;
            if (!key) {
                tg.showAlert('Please enter a key');
                return;
            }
            
            tg.CloudStorage.getItem(key, (error, value) => {
                const output = document.getElementById('cloudOutput');
                if (error) {
                    output.textContent = `Error: ${error}`;
                } else {
                    output.textContent = `Loaded: ${key} = ${value || '(not found)'}`;
                    document.getElementById('storageValue').value = value || '';
                }
            });
        }
        
        function removeFromCloud() {
            const key = document.getElementById('storageKey').value;
            if (!key) {
                tg.showAlert('Please enter a key');
                return;
            }
            
            tg.CloudStorage.removeItem(key, (error, success) => {
                const output = document.getElementById('cloudOutput');
                if (error) {
                    output.textContent = `Error: ${error}`;
                } else {
                    output.textContent = `Removed: ${key}`;
                    tg.HapticFeedback.notificationOccurred('success');
                }
            });
        }
        
        function getCloudKeys() {
            tg.CloudStorage.getKeys((error, keys) => {
                const output = document.getElementById('cloudOutput');
                if (error) {
                    output.textContent = `Error: ${error}`;
                } else {
                    output.textContent = `Keys: ${JSON.stringify(keys, null, 2)}`;
                }
            });
        }
        
        // Popups & Alerts
        function showAlert() {
            tg.showAlert('This is an alert message!', () => {
                console.log('Alert closed');
            });
        }
        
        function showConfirm() {
            tg.showConfirm('Do you want to proceed?', (confirmed) => {
                tg.showAlert(confirmed ? 'You clicked OK' : 'You clicked Cancel');
            });
        }
        
        function showPopup() {
            tg.showPopup({
                title: 'Custom Popup',
                message: 'This is a custom popup with multiple buttons',
                buttons: [
                    {id: 'save', type: 'default', text: 'Save'},
                    {id: 'delete', type: 'destructive', text: 'Delete'},
                    {id: 'cancel', type: 'cancel'}
                ]
            }, (buttonId) => {
                tg.showAlert(`You clicked: ${buttonId}`);
            });
        }
        
        function showScanQrPopup() {
            tg.showScanQrPopup({
                text: 'Scan a QR code'
            }, (data) => {
                if (data) {
                    tg.showAlert(`Scanned: ${data}`);
                    tg.closeScanQrPopup();
                    return true;
                }
            });
        }
        
        // Main Button
        function showMainButton() {
            tg.MainButton.setText('Click Me!');
            tg.MainButton.show();
            tg.MainButton.onClick(() => {
                tg.HapticFeedback.notificationOccurred('success');
                tg.showAlert('Main button clicked!');
            });
        }
        
        function hideMainButton() {
            tg.MainButton.hide();
        }
        
        function enableMainButton() {
            tg.MainButton.enable();
        }
        
        function disableMainButton() {
            tg.MainButton.disable();
        }
        
        function showProgress() {
            tg.MainButton.showProgress();
        }
        
        function hideProgress() {
            tg.MainButton.hideProgress();
        }
        
        // Back Button
        function showBackButton() {
            tg.BackButton.show();
            tg.BackButton.onClick(() => {
                tg.showConfirm('Go back?', (confirmed) => {
                    if (confirmed) {
                        tg.close();
                    }
                });
            });
        }
        
        function hideBackButton() {
            tg.BackButton.hide();
        }
        
        // Settings Button
        function showSettingsButton() {
            if (tg.SettingsButton) {
                tg.SettingsButton.show();
                tg.SettingsButton.onClick(() => {
                    tg.showAlert('Settings clicked!');
                });
            } else {
                tg.showAlert('Settings button not available');
            }
        }
        
        function hideSettingsButton() {
            if (tg.SettingsButton) {
                tg.SettingsButton.hide();
            }
        }
        
        // Biometric
        function updateBiometricInfo() {
            const info = document.getElementById('biometricInfo');
            if (tg.BiometricManager) {
                info.innerHTML = `
                    <strong>Available:</strong> ${tg.BiometricManager.isInited}<br>
                    <strong>Access Requested:</strong> ${tg.BiometricManager.isAccessRequested}<br>
                    <strong>Access Granted:</strong> ${tg.BiometricManager.isAccessGranted}<br>
                    <strong>Token Saved:</strong> ${tg.BiometricManager.isBiometricTokenSaved}<br>
                    <strong>Type:</strong> ${tg.BiometricManager.biometricType || 'N/A'}
                `;
            } else {
                info.textContent = 'Biometric not available';
            }
        }
        
        function requestBiometric() {
            if (tg.BiometricManager) {
                tg.BiometricManager.authenticate({
                    reason: 'Verify your identity'
                }, (success, token) => {
                    if (success) {
                        tg.showAlert(`Authenticated! Token: ${token || 'N/A'}`);
                    } else {
                        tg.showAlert('Authentication failed');
                    }
                    updateBiometricInfo();
                });
            } else {
                tg.showAlert('Biometric not available');
            }
        }
        
        function updateBiometricToken() {
            if (tg.BiometricManager) {
                tg.BiometricManager.updateBiometricToken('new-secure-token-123', (success) => {
                    tg.showAlert(success ? 'Token updated' : 'Failed to update token');
                    updateBiometricInfo();
                });
            }
        }
        
        updateBiometricInfo();
        
        // Links
        function openLink() {
            const url = document.getElementById('linkUrl').value;
            tg.openLink(url);
        }
        
        function openTelegramLink() {
            tg.openTelegramLink('https://t.me/durov');
        }
        
        function openInvoice() {
            tg.openInvoice('https://t.me/$invoice_url', (status) => {
                tg.showAlert(`Payment status: ${status}`);
            });
        }
        
        // Data Sending
        function sendDataToBot() {
            const data = document.getElementById('dataToSend').value;
            tg.sendData(data);
        }
        
        function closeApp() {
            tg.close();
        }
        
        // Theme
        function setHeaderColor(color) {
            tg.setHeaderColor(color);
            tg.HapticFeedback.impactOccurred('light');
        }
        
        function setBackgroundColor(color) {
            tg.setBackgroundColor(color);
            tg.HapticFeedback.impactOccurred('light');
        }
        
        // Viewport
        function expandViewport() {
            tg.expand();
            const info = document.getElementById('viewportInfo');
            info.textContent = `Height: ${tg.viewportHeight}px | Stable: ${tg.viewportStableHeight}px | Expanded: ${tg.isExpanded}`;
        }
        
        function requestWriteAccess() {
            tg.requestWriteAccess((granted) => {
                tg.showAlert(granted ? 'Write access granted!' : 'Write access denied');
            });
        }
        
        function requestContact() {
            tg.requestContact((granted) => {
                tg.showAlert(granted ? 'Contact shared!' : 'Contact not shared');
            });
        }
        
        // Listen to theme changes
        tg.onEvent('themeChanged', () => {
            document.getElementById('colorScheme').textContent = tg.colorScheme;
        });
        
        // Listen to viewport changes
        tg.onEvent('viewportChanged', () => {
            const info = document.getElementById('viewportInfo');
            info.textContent = `Height: ${tg.viewportHeight}px | Stable: ${tg.viewportStableHeight}px | Expanded: ${tg.isExpanded}`;
        });
        
        // Enable closing confirmation
        tg.enableClosingConfirmation();
    </script>
</body>
</html>
